"""
智能客服服务
基于关键词匹配和预置答案提供自动回复
"""

# 预置问答库
FAQ_DATABASE = {
    '报名': '高考报名一般在每年11月进行，请关注当地教育考试院官网获取最新通知。',
    '分数线': '各院校每年的录取分数线会在高考成绩公布后陆续发布，建议参考历年数据进行预估。',
    '志愿填报': '志愿填报一般在高考成绩公布后进行，请密切关注本省招生考试机构的通知。',
    '平行志愿': '平行志愿是指考生可以填报多个平行的志愿，按分数优先、遵循志愿的原则进行投档。',
    '提前批': '提前批次一般包括军校、公安院校、艺术院校等，在普通批次之前录取。',
    '专业调剂': '如果勾选服从专业调剂，在所填专业无法录取时，可能被调剂到其他专业。',
    '退档': '退档是指考生的档案被投递到某院校后，因不符合条件或计划已满而被退回。',
    '征集志愿': '征集志愿是在某批次录取结束后，对未完成招生计划的院校进行补充招生。',
    '院校代码': '院校代码是每所高校的唯一标识，填报志愿时需要使用正确的院校代码。',
    '专业代码': '专业代码是每个专业的唯一标识，填报志愿时需要与院校代码配合使用。',
}

# 关键词映射
KEYWORD_MAPPING = {
    '怎么报名': '报名',
    '如何报名': '报名',
    '报名时间': '报名',
    '录取分数': '分数线',
    '多少分': '分数线',
    '分数线查询': '分数线',
    '怎么填志愿': '志愿填报',
    '填报时间': '志愿填报',
    '什么是平行志愿': '平行志愿',
    '平行志愿规则': '平行志愿',
    '什么是提前批': '提前批',
    '要不要调剂': '专业调剂',
    '服从调剂': '专业调剂',
    '什么是退档': '退档',
    '为什么退档': '退档',
    '征集志愿时间': '征集志愿',
    '怎么查院校代码': '院校代码',
    '怎么查专业代码': '专业代码',
}


def get_ai_response(message):
    """
    获取智能客服回复
    
    Args:
        message: 用户消息
        
    Returns:
        str: 自动回复内容
    """
    # 1. 先尝试关键词映射
    for keyword, category in KEYWORD_MAPPING.items():
        if keyword in message:
            return FAQ_DATABASE.get(category, _default_response())
    
    # 2. 直接匹配FAQ关键词
    for keyword, answer in FAQ_DATABASE.items():
        if keyword in message:
            return answer
    
    # 3. 返回默认回复
    return _default_response()


def add_faq(keyword, answer):
    """
    添加FAQ条目
    
    Args:
        keyword: 关键词
        answer: 回答内容
    """
    FAQ_DATABASE[keyword] = answer


def get_all_faqs():
    """获取所有FAQ条目"""
    return [{'keyword': k, 'answer': v} for k, v in FAQ_DATABASE.items()]


def _default_response():
    """默认回复"""
    return '感谢您的咨询！您的问题已收到，我们的客服人员将尽快为您解答。如需紧急帮助，请拨打热线电话。'
